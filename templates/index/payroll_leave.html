<!DOCTYPE html>
<html>
{% load static %}
<head>
    <!-- Basic Page Info -->
    <meta charset="utf-8">
    <title>HRMS</title>
    <link rel="icon" href="/static/logo/apple-touch-icon.png" type="image/x-icon">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <!-- Site favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="static/index/vendors/images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="static/index/vendors/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="static/index/vendors/images/favicon-16x16.png">

    <!-- Mobile Specific Metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="/static/index/vendors/styles/core.css">
    <link rel="stylesheet" type="text/css" href="/static/index/vendors/styles/icon-font.min.css">
    <link rel="stylesheet" type="text/css" href="/static/index/vendors/styles/style.css">

    <!-- AG Grid CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ag-grid-community@31.0.2/styles/ag-grid.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ag-grid-community@31.0.2/styles/ag-theme-alpine.css" />

    <!-- Jquery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
        integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
    <!-- jQuery UI for Datepicker -->
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>

    <!-- AG Grid JS -->
    <script src="https://cdn.jsdelivr.net/npm/ag-grid-community@31.0.2/dist/ag-grid-community.min.js"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-119386393-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
         window.dataLayer = window.dataLayer || [];
        gtag('js', new Date());
        gtag('config', 'UA-119386393-1');
    </script>

    <style>
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: auto;
        }

        .header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            background-color: #fff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 10px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 10px; /* Consistent spacing between elements */
        }

        .menu-icon, .search-toggle-icon {
            cursor: pointer;
            padding-left: 30px;
        }

        .header-search {
            position: relative;
            flex-grow: 1;
            max-width: 700px;
            
        }

        .header-search form {
            display: flex;
            align-items: center;
            padding-left: 400px;
            
        }

        .header-search .form-group {
            flex-grow: 1;
            margin: 0;
            position: relative;
            padding-top: 10px;
        }

        .header-search .search-icon {
            position: absolute;
            left: 10px;
            top: 40%;
            transform: translateY(-50%);
            color: #666;
            padding-top: 40px;
        }

        .header-search .form-control {
            padding-left: 30px;
            height: 44px;
            border-radius: 4px;
            width: 300px;
            padding-top: 10px;
        }

        .header-search .dropdown {
            margin-left: 10px;
        }

        .month-picker-container {
            position: relative;
            width: 150px;
            padding-left: 300px;
             padding-top: 10px;
        }

        .month-picker-container .form-control {
            height: 34px;
            border-radius: 4px;
            padding-right: 30px;
           
            width: 200px;
        }

        .month-picker-container .clear-icon {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: grey;
        }

        .user-info-dropdown {
            display: flex;
            align-items: center;
            gap: 10px;
            padding-left: 250px;
        }

        .user-info-dropdown .user-icon {
            width: 34px;
            height: 34px;
            border-radius: 50%;
            overflow: hidden;
        }

        .user-info-dropdown .user-name {
            font-size: 14px;
            color: #333;
        }

        .left-side-bar {
            position: fixed;
            top: 60px;
            left: 0;
            width: 250px;
            height: calc(100vh - 60px);
            background-color: #151d25;
            z-index: 900;
            overflow-y: auto;
        }

        .main-container {
            margin-left: 250px;
            margin-top: 60px;
            padding: 20px;
        }

        .circular-button {
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .larger-icon {
            font-size: 24px;
        }

        .container-with-scrollbar {
            max-height: 100px;
            overflow-y: auto;
            border: 2px solid rgb(213, 209, 209);
        }

        .rule-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 50px;
            background-color: white;
            font-size: 15px;
            position: relative;
            margin-top: 5px;
            margin-left: 5px;
            margin-bottom: 5px;
            border: 2px solid rgb(213, 209, 209);
        }

        .emp_count {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 50px;
            background-color: lightgray;
            font-size: 15px;
            position: relative;
            margin-top: 5px;
            margin-left: 5px;
            margin-bottom: 5px;
            border: 2px solid rgb(213, 209, 209);
        }

        .optional-field {
            display: inline-block;
            padding: 5px 10px;
        }

        .check-box {
            transform: scale(1.5);
            margin-right: 5px;
        }

        /* AG Grid Styles */
        .ag-theme-alpine {
            --ag-grid-size: 4px;
            --ag-header-background-color: #fff;
            --ag-odd-row-background-color: #eaeef2;
            --ag-row-hover-background-color: #f0f0f0;
            height: 350px;
            width: 100%;
        }

        .ag-header-cell {
            white-space: nowrap;
            text-align: left !important;
            background-color: #3f51b5;
        }

        .ag-header-cell:hover {
            background-color: #ffffff;
            color: rgb(13, 13, 13);
            border-right: 1px solid #5c6bc0;
            padding: 10px 8px;
        }

        .ag-cell {
            border: 1px solid #e0e0e0;
        }

        .ag-cell[data-col-id="empid"] {
            position: sticky;
            left: 0;
            background-color: #fff;
            z-index: 30;
        }

        .ag-cell[data-col-id="name"] {
            position: sticky;
            left: 120px;
            background-color: #fff;
            z-index: 25;
        }

        .ag-cell[data-col-id="action"] {
            color: inherit;
        }

        .ag-cell[data-col-id="action"][data-status="Approved"] {
            color: green;
        }

        .ag-cell[data-col-id="action"][data-status="Rejected"] {
            color: red;
        }

        .ag-cell[data-col-id="action"][data-status="Applied"] {
            color: yellow;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-left">
            <div class="menu-icon dw dw-menu"></div>
            <div class="search-toggle-icon dw dw-search2" data-toggle="header_search"></div>
            <div class="header-search">
                <form action="{% url 'payroll_leave' %}" method="GET">
                    <div class="form-group">
                        <i class="dw dw-search2 search-icon"></i>
                        <input type="text" data-live-search="true" class="form-control search-input" name="search" {% if query is None %} placeholder="Search " {% else %} value="{{query}}" {% endif %}>
                        <span class="clear-icon" onclick="this.previousElementSibling.value = ''; this.previousElementSibling.focus();">
                            <a href="{% url 'payroll_leave' %}" style="color: grey;">x</a>
                        </span>
                        <div class="dropdown">
                            <button class="btn-primary dropdown-toggle no-arrow" role="button">
                                <i class="fa fa-search" style="color:White"></i>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
            <form action="{% url 'payroll_leave' %}" method="get" id="search-form">
                <div class="month-picker-container">
                    <div class="form-group">
                        <input id="monthPicker" name="monthselect" class="form-control month-picker" type="text" />
                        <span class="clear-icon" onclick="this.previousElementSibling.value = ''; this.previousElementSibling.focus();">
                            <a href="{% url 'payroll_leave' %}" style="color: grey;">x</a>
                        </span>
                    </div>
                </div>
            </form>
            <div class="user-info-dropdown">
                <div class="dropdown">
                    <a class="dropdown-toggle" href="#" role="button" data-toggle="dropdown">
                        <span class="user-icon">
                            {% if k.image %}
                                <img src="{{ k.image.url }}" alt="" style="width: 100%; height:100% ">
                            {% else %}
                                <img src="/static/logo/userlogo.png" id="photo" style="width: 100%; height:100% ">
                            {% endif %}                    
                        </span>
                        <span class="user-name">{{request.user.username}}</span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-right dropdown-menu-icon-list">
                        <a class="dropdown-item" href="{% url 'createpersonalinfo' %}"><i class="dw dw-user1"></i> Profile</a>
                        <a class="dropdown-item" href="{% url 'department' %}" data-toggle="right-sidebar"><i class="dw dw-settings2"></i> Settings</a>
                        <a class="dropdown-item" href="{% url 'help_page' %}"><i class="dw dw-help"></i> Help</a>
                        <a class="dropdown-item" href="{% url 'logout' %}"><i class="dw dw-logout"></i> Logout</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="left-side-bar">
        <div class="brand-logo mt-3">
            <a href="{% url 'dashboard' %}">
                {% if request.user.company_type %}
                    {% if request.user.company_type.inverse_logo %}
                        <img src="{{ request.user.company_type.inverse_logo.url }}" style="width: 100%; height: 100%;">
                    {% else %}
                        <img src="/static/logo/deskapp-logo-white.svg" alt="" class="light-logo">
                    {% endif %}
                {% else %}
                    <img src="/static/logo/deskapp-logo-white.svg" alt="" class="light-logo">
                {% endif %}
            </a>
            <div class="close-sidebar" data-toggle="left-sidebar-close">
                <i class="ion-close-round"></i>
            </div>
        </div>
        <div class="menu-block customscroll">
            <div class="sidebar-menu">
                <ul id="accordion-menu">
                    <br>
                    <li class="btn-primary active" style="background-color:black">
                        <a href="{% url 'dashboard' %}" class="dropdown-toggle no-arrow">
                            <span class="micon dw dw-house-1"></span><span class="mtext"><b>Dashboard</b></span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'companyprofile' %}" class="dropdown-toggle no-arrow">
                            <span class="micon dw dw-building"></span><span class="mtext"><b>Company Profile</b></span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'personalinfonav' %}" class="dropdown-toggle no-arrow">
                            <span class="micon dw dw-user1"></span><span class="mtext"><b>My Profile</b></span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'leave' %}" class="dropdown-toggle no-arrow">
                            <span class="micon dw dw-calendar-1"></span><span class="mtext"><b>Leave</b></span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'directory' %}" class="dropdown-toggle no-arrow">
                            <span class="micon dw dw-list"></span><span class="mtext"><b>Directory</b></span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'dailylog' %}" class="dropdown-toggle no-arrow">
                            <span class="micon bi bi-check2-square"></span><span class="mtext"><b>Attendance</b></span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'calender' %}" class="dropdown-toggle no-arrow">
                            <span class="micon dw dw-calendar"></span><span class="mtext"><b>Holiday Calendar</b></span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'runpayroll_overview' %}" class="dropdown-toggle no-arrow">
                            <span class="micon dw dw-money-2"></span><span class="mtext"><b>Payroll</b></span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <div class="main-container">
        <div class="card-box">
            <ul class="nav nav-tabs customtab" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" href="{% url 'runpayroll_overview' %}">Run Payroll</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'create_salary' %}">Setup Payroll</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'payroll_dec' %}">Declaration</a>
                </li>
            </ul>
            <div class="min-height-100px">
                <ul class="nav nav-tabs customtab" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'runpayroll_overview' %}">Overview</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="{% url 'runpayroll' %}">Attendance & Leave</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'salary_revision' %}">Salary Revision</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'pay_register' %}">Pay Register</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'payout' %}">Payout</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'adhoc_component' %}">Variable & Adhoc</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'salary_onhold' %}">Salary on Hold</a>
                    </li>
                </ul>
            </div>
            <div class="min-height-100px">
                <ul class="nav nav-tabs customtab" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'runpayroll' %}">Attendance</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="{% url 'payroll_leave' %}">Leave</a>
                    </li>
                </ul>
            </div>

            <div class="pd-20 card-box">
                {% csrf_token %}
                <div class="modal fade bs-example-modal-lg" id="export" tabindex="-1" role="dialog"
                    aria-labelledby="myLargeModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="modal-title">Export</h4>
                                <button type="button" class="close" data-dismiss="modal">×</button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <span class="emp_count" id="selected-employees-count">0 Employee Selected</span>
                                            <hr>
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <label>Selected Fields</label>
                                        <div class="form-group container-with-scrollbar">
                                            <ul id="selected-fields-list">
                                                <li class="rule-badge">Employee ID</li>
                                                <li class="rule-badge">Employee Name</li>
                                                <li class="rule-badge">Department</li>
                                                <li class="rule-badge">Designation</li>
                                                <li class="rule-badge">Primary Manager</li>
                                                <li class="rule-badge">Secondary Managers</li>
                                                <li class="rule-badge">Job Title</li>
                                                <li class="rule-badge">DOJ</li>
                                                <li class="rule-badge">Work Location</li>
                                                <li class="rule-badge">Employee Status</li>
                                                <li class="rule-badge">Employee Type</li>
                                                <li class="rule-badge">Probation Period</li>
                                                <li class="rule-badge">Contact Number</li>
                                                <li class="rule-badge">Official Email ID</li>
                                                <li class="rule-badge">Personal Email ID</li>
                                                <li class="rule-badge">Employee Emergency Contacts</li>
                                                <li class="rule-badge">CTC</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-9">
                                        <label>Select Optional Fields</label>
                                    </div>
                                    <div class="col-md-3 dtcheckbox">
                                        <input type="checkbox" style="transform: scale(1.5);" name="selectall"
                                            id="selectallcheckbox">
                                        <span class="dt-checkbox-label"></span>
                                        <label>Select All</label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group container-with-scrollbar">
                                            <ul id="optional-fields-list">
                                                <li class="optional-field">
                                                    <input type="checkbox" class="check-box" name="subdep" id="subdep"><span
                                                        class="dt-checkbox-label"></span>
                                                    Sub Department
                                                </li>
                                                <li class="optional-field">
                                                    <input type="checkbox" class="check-box" name="marital-status"
                                                        id="marital-status"><span class="dt-checkbox-label"></span>
                                                    Marital Status
                                                </li>
                                                <li class="optional-field">
                                                    <input type="checkbox" class="check-box" name="bloodgp" id="bloodgp"><span
                                                        class="dt-checkbox-label"></span>
                                                    Blood Group
                                                </li>
                                                <li class="optional-field">
                                                    <input type="checkbox" class="check-box" name="address1" id="address1"><span
                                                        class="dt-checkbox-label"></span>
                                                    Current Address
                                                </li>
                                                <li class="optional-field">
                                                    <input type="checkbox" class="check-box" name="address2" id="address2"><span
                                                        class="dt-checkbox-label"></span>
                                                    Permanent Address
                                                </li>
                                                <li class="optional-field">
                                                    <input type="checkbox" class="check-box" name="eduinfo" id="eduinfo"><span
                                                        class="dt-checkbox-label"></span>
                                                    Educational Info
                                                </li>
                                                <li class="optional-field">
                                                    <input type="checkbox" class="check-box" name="familymembers"
                                                        id="familymembers"><span class="dt-checkbox-label"></span>
                                                    Family Members
                                                </li>
                                                <li class="optional-field">
                                                    <input type="checkbox" class="check-box" name="idproof" id="idproof"><span
                                                        class="dt-checkbox-label"></span>
                                                    ID Proof
                                                </li>
                                                <li class="optional-field">
                                                    <input type="checkbox" class="check-box" name="otherdocument"
                                                        id="otherdocument"><span class="dt-checkbox-label"></span>
                                                    Other Documents
                                                </li>
                                                <li class="optional-field">
                                                    <input type="checkbox" class="check-box" name="lastworkingday"
                                                        id="lastworkingday"><span class="dt-checkbox-label"></span>
                                                    Last Working Day
                                                </li>
                                                <li class="optional-field">
                                                    <input type="checkbox" class="check-box" name="workhistory"
                                                        id="workhistory"><span class="dt-checkbox-label"></span>
                                                    Work History
                                                </li>
                                                <li class="optional-field">
                                                    <input type="checkbox" class="check-box" name="leaverules" id="leaverules"><span
                                                        class="dt-checkbox-label"></span>
                                                    Leave Rules
                                                </li>
                                                <li class="optional-field">
                                                    <input type="checkbox" class="check-box" name="attendancerules"
                                                        id="attendancerules"><span class="dt-checkbox-label"></span>
                                                    Attendance Rules
                                                </li>
                                                <li class="optional-field">
                                                    <input type="checkbox" class="check-box" name="workweekrules"
                                                        id="workweekrules"><span class="dt-checkbox-label"></span>
                                                    Workweek Rules
                                                </li>
                                                <li class="optional-field">
                                                    <input type="checkbox" class="check-box" name="gender" id="gender"><span
                                                        class="dt-checkbox-label"></span>
                                                    Gender
                                                </li>
                                                <li class="optional-field">
                                                    <input type="checkbox" class="check-box" name="dob" id="dob"><span
                                                        class="dt-checkbox-label"></span>
                                                    DOB
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                <input type="submit" class="btn btn-primary" value="Download" id="submit-button" data-toggle="modal"
                                    href="#downloadexcel" disabled> </input>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="leaveGrid" class="ag-theme-alpine" style="height: 350px; width: 100%;"></div>
                <br>

                <form action="{% url 'export_runpayroll' %}" method="post" onsubmit="return validateForm()">
                    {% csrf_token %}
                    <div class="modal fade bs-example-modal-sm" id="export_Modal" tabindex="-1" role="dialog"
                        aria-labelledby="myLargeModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered modal-sm">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h4 class="modal-title">Export</h4>
                                    <button type="button" class="close" data-dismiss="modal">×</button>
                                </div>
                                <div class="modal-body">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <label>Select Month</label>
                                        </div>
                                        <div class="col-md-12">
                                            <label>Select <span style="color:red"> *</span></label>
                                            <div class="form-group">
                                                <input class="form-control month-picker" type="text" name="month" id="month"
                                                    placeholder="mm-yyyy" style="background-color: white;" readonly>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                    <button type="submit" id="exportButton" class="btn btn-primary" data-toggle="modal"
                                        href="">Export</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>

                <div class="modal fade bs-example-modal-md" id="downloadexcel" tabindex="-1" role="dialog"
                    aria-labelledby="myLargeModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered modal-md">
                        <div class="modal-content">
                            <div class="modal-body">
                                <div>
                                    <i class="icon-copy fa fa-check-circle" aria-hidden="true"
                                        style="color: green; font-size: 90px; margin-left: 45%;"></i>
                                </div>
                                <div style="margin-left: 15%;">
                                    <b>Your request for export have been queued</b>
                                </div>
                                <div style="margin-left: 10%; justify-content: center;">
                                    As soon as the export process is complete, you will receive an email with the download link.
                                    You may also view the status of your request by clicking File Manager
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                <a href="{% url 'filemanagernav' %}" type="button" class="btn btn-primary btn-sm ">File
                                    Manager</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- js -->
    <script src="/static/index/vendors/scripts/core.js"></script>
    <script src="/static/index/vendors/scripts/script.min.js"></script>
    <script src="/static/index/vendors/scripts/process.js"></script>
    <script src="/static/index/vendors/scripts/layout-settings.js"></script>
    <script src="/static/index/src/plugins/apexcharts/apexcharts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const gridOptions = {
                columnDefs: [
                    { 
                        headerName: "Emp ID", 
                        field: "empid", 
                        width: 120,
                        pinned: 'left',
                        cellRenderer: params => {
                            return `<a href="/view_personalinfo${params.data.id}">${params.value}</a>`;
                        }
                    },
                    { 
                        headerName: "Name", 
                        field: "name", 
                        width: 150,
                        pinned: 'left',
                        cellRenderer: params => {
                            return `<a href="/view_personalinfo${params.data.id}">${params.value}</a>`;
                        }
                    },
                    { 
                        headerName: "Date", 
                        field: "date", 
                        width: 200,
                        valueGetter: function(params) {
                            return `${params.data.strtDate} - ${params.data.endDate}`;
                        }
                    },
                    { headerName: "Total Days", field: "days", width: 120 },
                    { headerName: "Leave Type", field: "leavetyp", width: 150 },
                    { 
                        headerName: "Status", 
                        field: "status", 
                        width: 120,
                        valueGetter: function(params) {
                            return params.data.status || '';
                        }
                    },
                    { 
                        headerName: "Manager", 
                        field: "manager", 
                        width: 150,
                        valueGetter: function(params) {
                            return params.data.manager_username;
                        }
                    },
                    { 
                        headerName: "Action", 
                        field: "action", 
                        width: 120,
                        cellRenderer: function(params) {
                            const status = params.data.status;
                            if (status === 'Approved') {
                                return '<span style="color: green;">Approved</span>';
                            } else if (status === 'Rejected') {
                                return '<span style="color: red;">Rejected</span>';
                            } else if (status === 'Applied') {
                                return '<span style="color: yellow;">Pending</span>';
                            }
                            return '';
                        },
                        cellClassRules: {
                            'ag-cell[data-status="Approved"]': 'data.status === "Approved"',
                            'ag-cell[data-status="Rejected"]': 'data.status === "Rejected"',
                            'ag-cell[data-status="Applied"]': 'data.status === "Applied"'
                        }
                    }
                ],
                rowData: [
                    {% for i in datas %}
                    {
                        id: {{ i.applicant_email.id }},
                        empid: "{{ i.applicant_email.empid | escapejs }}",
                        name: "{{ i.applicant_email.username | escapejs }}",
                        strtDate: "{{ i.strtDate | date:'F j' | escapejs }}",
                        endDate: "{{ i.endDate | date:'F j' | escapejs }}",
                        days: {{ i.Days }},
                        leavetyp: "{{ i.leavetyp | escapejs }}",
                        status: "{{ i.status | default:'' | escapejs }}",
                        manager_username: "{{ i.applicant_email.reptmgr.username | escapejs }}"
                    }{% if not forloop.last %},{% endif %}
                    {% endfor %}
                ],
                defaultColDef: {
                    resizable: true,
                    sortable: false
                },
                pagination: true,
                paginationPageSize: 50,
                domLayout: 'normal',
                onGridReady: function(params) {
                    params.api.sizeColumnsToFit();
                }
            };

            const gridDiv = document.querySelector('#leaveGrid');
            if (gridDiv) {
                new agGrid.Grid(gridDiv, gridOptions);
            } else {
                console.error('Grid container #leaveGrid not found');
            }
        });

        $(document).ready(function () {
            function getUrlParameter(name) {
                name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
                var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
                var results = regex.exec(location.search);
                return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
            }

            var urlSelectedDate = getUrlParameter('monthselect');
            var selectedDate = urlSelectedDate || new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            var localStorageSelectedDate = localStorage.getItem("monthselect");

            $("#monthPicker").datepicker({
                dateFormat: 'MM yyyy',
                changeMonth: true,
                changeYear: true,
                showButtonPanel: true,
                onClose: function(dateText, inst) {
                    $(this).datepicker('setDate', new Date(inst.selectedYear, inst.selectedMonth, 1));
                },
                onSelect: function (date) {
                    selectedDate = date;
                    localStorage.setItem("monthselect", selectedDate);
                    $("#search-form").submit();
                }
            });

            if (localStorageSelectedDate) {
                $("#monthPicker").val(localStorageSelectedDate);
                if ($("#monthPicker").val() !== selectedDate) {
                    $("#search-form").submit();
                }
            } else {
                $("#monthPicker").val(selectedDate);
            }

            // Ensure modals work with Bootstrap
            $('.modal').on('show.bs.modal', function () {
                $('.modal').not(this).modal('hide');
            });
        });

        function validateForm() {
            var month = document.getElementById("month").value;
            if (!month) {
                alert("Please select a month.");
                return false;
            }
            return true;
        }
    </script>
</body>
</html>