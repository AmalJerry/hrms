<!DOCTYPE html>
<html>
{% load static %} {% load custom_filters %}

<head>
  <!-- Basic Page Info -->
  <meta charset="utf-8" />
  <title>HRMS</title>
  <link rel="icon" href="/static/logo/apple-touch-icon.png" type="image/x-icon" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

  <!-- Mobile Specific Metas -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
  <!-- CSS -->
  <link rel="stylesheet" type="text/css" href="static/index/vendors/styles/core.css" />
  <link rel="stylesheet" type="text/css" href="static/index/vendors/styles/icon-font.min.css" />
  <link rel="stylesheet" type="text/css" href="static/index/src/plugins/jquery-steps/jquery.steps.css" />
  <link rel="stylesheet" type="text/css" href="static/index/vendors/styles/style.css" />
  <!-- AG Grid CSS -->
  <link rel="stylesheet" href="https://unpkg.com/ag-grid-community@32.1.0/dist/styles/ag-grid.css" />
  <link rel="stylesheet" href="https://unpkg.com/ag-grid-community@32.1.0/dist/styles/ag-theme-alpine.css" />

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-119386393-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag("js", new Date());
    gtag("config", "UA-119386393-1");
  </script>
  <style>
    .in__time__radio {
      margin-left: 1rem;
    }
    .out__time__radio {
      margin-right: 1rem;
    }
    .time__select {
      border-width: 0px 0 1px;
      padding-left: 0.5rem;
      font-size: 15px;
      color: #464545;
      border-color: #ccc;
      margin-right: 10px;
      line-height: 0.7;
      width: 24%;
      background-color: white;
    }
    .datepickers-container {
      top: -30% !important;
    }
    input[type="radio"] {
      accent-color: dodgerblue;
    }
    /* AG Grid custom styles to match table-striped */
    .ag-theme-alpine .ag-row-odd {
      background-color: #f9f9f9;
    }
    .ag-theme-alpine .ag-row-even {
      background-color: #fff;
    }
    .ag-theme-alpine .ag-header {
       background-color: #3f51b5; !important;
    }
    .ag-theme-alpine {
      --ag-grid-size: 4px;
      --ag-row-height: 40px;
      --ag-header-height: 40px;
    }
    
        .ag-header-cell:hover {
            background-color: #ffffff;
            color: rgb(0, 0, 0);
            border-right: 1px solid #5c6bc0;
            padding: 10px 8px;
        }
  </style>
</head>

<body>
  <div class="header">
    <div class="header-left">
      <div class="menu-icon dw dw-menu"></div>
    </div>
    <div class="header-right">
      <div class="user-info-dropdown">
        <div class="dropdown">
          <a class="dropdown-toggle" href="#" role="button" data-toggle="dropdown">
            <span class="user-icon">
              {% if k.image %}
              <img src="{{ k.image.url }}" alt="" style="width: 100%; height: 100%" />
              {% else %}
              <img src="/static/logo/userlogo.png" id="photo" style="width: 100%; height: 100%" />
              {% endif %}
            </span>
            <span style="margin-left: 0px" class="user-name">{{request.user.username}}</span>
          </a>
          <div class="dropdown-menu dropdown-menu-right dropdown-menu-icon-list">
            <a class="dropdown-item" href="{% url 'profile' %}"><i class="dw dw-user1"></i> Profile</a>
            <a class="dropdown-item" href="{% url 'help_page' %}"><i class="dw dw-help"></i> Help</a>
            <a class="dropdown-item" href="{% url 'logout' %}"><i class="dw dw-logout"></i> Logout</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="left-side-bar">
    <div class="brand-logo mt-3">
      <a href="{% url 'dashboard' %}">
        {% if request.user.company_type %}
        {% if request.user.company_type.inverse_logo %}
        <img src="{{ request.user.company_type.inverse_logo.url }}" style="width: 100%; height: 100%;">
        {% else %}
        <img src="/static/logo/deskapp-logo-white.svg" alt="" class="light-logo">
        {% endif %}
        {% else %}
        <img src="/static/logo/deskapp-logo-white.svg" alt="" class="light-logo">
        {% endif %}
      </a>
      <div class="close-sidebar" data-toggle="left-sidebar-close">
        <i class="ion-close-round"></i>
      </div>
    </div>

    <div class="menu-block customscroll">
      <div class="sidebar-menu">
        <ul id="accordion-menu">
          <br>
          <li class="btn-primary active" style="background-color:black">
            <a href="{% url 'dashboard' %}" class="dropdown-toggle no-arrow">
              <span class="micon dw dw-house-1"></span><span class="mtext"><b>Dashboard</b></span>
            </a>
          </li>
          <li>
            <a href="{% url 'companyprofile' %}" class="dropdown-toggle no-arrow">
              <span class="micon dw dw-building"></span><span class="mtext"><b>Company Profile</b></span>
            </a>
          </li>
          <li>
            <a href="{% url 'personalinfonav' %}" class="dropdown-toggle no-arrow">
              <span class="micon dw dw-user1"></span><span class="mtext"><b>My Profile</b></span>
            </a>
          </li>
          <li>
            <a href="{% url 'leave' %}" class="dropdown-toggle no-arrow">
              <span class="micon dw dw-calendar-1"></span><span class="mtext"><b>Leave</b></span>
            </a>
          </li>
          <li>
            <a href="{% url 'directory' %}" class="dropdown-toggle no-arrow">
              <span class="micon dw dw-list"></span><span class="mtext"><b>Directory</b></span>
            </a>
          </li>
          <li>
            <a href="{% url 'dailylog' %}" class="dropdown-toggle no-arrow">
              <span class="micon bi bi-check2-square"></span><span class="mtext"><b>Attendance</b></span>
            </a>
          </li>
          <li>
            <a href="{% url 'calender' %}" class="dropdown-toggle no-arrow">
              <span class="micon dw dw-calendar"></span><span class="mtext"><b>Holiday Calendar</b></span>
            </a>
          </li>
          <li>
            <a href="{% url 'runpayroll_overview' %}" class="dropdown-toggle no-arrow">
              <span class="micon dw dw-money-2"></span><span class="mtext"><b>Payroll</b></span>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </div>
  <div class="mobile-menu-overlay"></div>

  <div class="main-container">
    {% include 'messages.html' %}
    <div class="card-box height-100-p overflow-hidden">
      <ul class="nav nav-tabs customtab" role="tablist">
        <li class="nav-item">
          <a class="nav-link active" href="#">Logs</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{% url 'attendance_logs' %}">Attendance Logs</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{% url 'search_punch_logs' %}">Attendance Month Logs</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{% url 'automationlog' %}">Automation Logs</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{% url 'list-request-approvals' %}">Approvals</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{% url 'attendanceRule' %}">Rules</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{% url 'view_assignattendancerule' %}">Assign Rule</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{% url 'attendance_workweek' %}">Work Week</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{% url 'view_assignworkweek' %}">Assign Work Week</a>
        </li>
      </ul>
      <div class="min-height-200px pd-20">
        <div class="tab">
          <ul class="nav nav-pills" role="tablist">
            <li class="nav-item">
              <a class="nav-link" href="{% url 'dailylog' %}">Daily Log</a>
            </li>
            <li class="nav-item">
              <a class="nav-link text-blue active text-blue" href="#profile5">Monthly Log</a>
            </li>
          </ul>
          <hr />
          <div class="d-flex justify-content-between">
            <div class="row" style="width: 57%; padding-left:1.5rem">
              <div style="margin-left: 2%;text-wrap: pretty;">
                <p>
                  <strong>*Status Legend:</strong>
                  P:Present, A: Absent, L: Leave, WO: Weekly off, H: Holiday,
                  HL: Half day leave,
                  <span style="color: red">AN: Anomaly,</span>
                  <span style="color: red">AC: Auto Clock-out</span>
                </p>
              </div>
            </div>
            <div class="row" style="width: 30%;">
              <form action="{% url 'monthly_log' %}" method="get" id="search-form">
                <div class="user-info-dropdown" id="search">
                  <div class="dropdown" style="position: relative;">
                    <div class="form-group" style="position: relative;">
                      <input id="monthPicker" name="monthselect" class="form-control month-picker" type="text"
                        style="margin-left: -10%; padding-right: 20px;" />
                      <span
                        style="position: absolute; right: 25%; top: 50%; transform: translateY(-50%); cursor: pointer;"
                        onclick="document.getElementById('monthPicker').value = ''; document.getElementById('monthPicker').focus();"
                        id="cross">
                        <a href="{% url 'monthly_log' %}" style="color: grey;">x</a>
                      </span>
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </div>

          <div class="tab-content">
            <!-- MONTHLY LOG -->
            <div class="tab-pane fade show active" id="profile5" role="tabpanel">
              <div class="pd-20">
                <div id="myGrid" style="height: 600px; width: 100%;" class="ag-theme-alpine"></div>
                <!-- Pagination -->
                <div class="paginator"
                  style="width:100%;display: flex;justify-content: space-between;align-items: center;">
                  <div style="float:left; margin-top: 20px;padding-left: 10px;">
                    Showing {{ punch_in_month.start_index}} to {{ punch_in_month.end_index }} of {{punch_in_month.paginator.count }} entries
                  </div>
                  {% if punch_in_month.paginator.count == 0 %}<p>No Records Found</p>{% endif %}
                  <div style="float:right;"><br>
                    <nav aria-label="Page navigation example">
                      <ul class="pagination" style="padding-right: 5px;padding-bottom: 5px;">
                        {% if punch_in_month.has_previous %}
                        <li class="page-item">
                          <a class="page-link"
                            href="?monthselect={{selected_date|date:'F Y'}}&page={{ punch_in_month.previous_page_number }}">« Previous</a>
                        </li>
                        {% else %}
                        <li class="page-item disabled">
                          <a class="page-link">«</a>
                        </li>
                        {% endif %}
                        {% for i in punch_in_month.paginator.page_range %}
                        {% if i <= punch_in_month.number|add:5 and i >= punch_in_month.number|add:-5 %}
                          {% if punch_in_month.number == i %}
                          <li class="page-item active">
                            <a class="page-link"
                              href="?monthselect={{selected_date|date:'F Y'}}&page={{forloop.counter}}">{{forloop.counter}}</a>
                          </li>
                          {% else %}
                          <li class="page-item">
                            <a class="page-link"
                              href="?monthselect={{selected_date|date:'F Y'}}&page={{forloop.counter}}">{{forloop.counter}}</a>
                          </li>
                          {% endif %}
                        {% endif %}
                        {% endfor %}
                        {% if punch_in_month.has_next %}
                        <li class="page-item">
                          <a class="page-link"
                            href="?monthselect={{selected_date|date:'F Y'}}&page={{ punch_in_month.next_page_number }}">» Next</a>
                        </li>
                        {% else %}
                        <li class="page-item disabled">
                          <a class="page-link">»</a>
                        </li>
                        {% endif %}
                      </ul>
                    </nav>
                  </div>
                </div>
                <!-- End Pagination -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="">
    <form action="{% url 'export-automation-log' %}" method="post" onsubmit="return validateForm()">
      {% csrf_token %}
      <div class="modal fade bs-example-modal-sm" id="export_Modal" tabindex="-1" role="dialog"
        aria-labelledby="myLargeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-sm">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title">Export</h4>
              <button type="button" class="close" data-dismiss="modal">×</button>
            </div>
            <div class="modal-body">
              <div class="row">
                <div class="col-md-12">
                  <label>Select Month and Year</label>
                </div>
                <div class="col-md-12">
                  <div class="form-group">
                    <input class="form-control month-picker" type="text" name="month" id="month"
                      placeholder="Select Month and Year" style="background-color: white;" required>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
              <button type="submit" id="exportButton" class="btn btn-primary" data-toggle="modal">Export</button>
            </div>
          </div>
        </div>
      </div>
    </form>
  </div>
  <!-- Radio Button Modal -->
  <div class="modal fade bs-example-modal-md" id="requestModal">
    <div class="modal-dialog modal-md modal-dialog-centered">
      <div class="modal-content">
        <form action="{% url 'request-approval' %}" method="post">
          {% csrf_token %}
          <div class="modal-header" style="background-color: #fff;">
            <h4 class="modal-title" id="myLargeModalLabel1" style="color: #000;">Request Approval</h4>
            <button type="button" class="close btn" data-dismiss="modal" aria-hidden="true">×</button>
          </div>
          <!-- input hidden punch Id -->
          <input type="hidden" name="punch_id" id="punch_id">
          <!-- End -->
          <div class="modal-body">
            <div class="row d-flex justify-content-center align-items-center text-center">
              <div class="col">
                <input type="radio" name="request_approval" id="markAsPresent" value="1" checked>
                <label for="markAsPresent">Mark as Present</label>
              </div>
              <div class="col">
                <input type="radio" name="request_approval" id="markAsLeave" value="2">
                <label for="markAsLevae">Mark as Leave</label>
              </div>
            </div>
            <div class="row d-flex justify-content-center align-items-center text-center">
              <div class="col">
                <input type="radio" name="request_approval" id="markExactTime" value="3">
                <label for="markExactTime">Mark Exact Time</label>
              </div>
              <div class="col">
                <input type="radio" name="request_approval" id="markAsLOP" value="4">
                <label for="markAsLOP" style="margin-right: 0.813rem;">Mark as LOP</label>
              </div>
            </div>
            <hr>
            <li id="exactTimeEdit" style="display: none;">
              <div class="row no-gutters">
                <div class="col-md-6 col-sm-6">
                  <span class="mx-3 font-semi">In Time</span>
                  <div class="in__time__radio">
                    <select class="time__select" name="inHour" id="inHour"></select>
                    <select class="time__select" name="inMinutes" id="inMinutes"></select>
                    <select class="time__select" name="inMidDay" id="inMidDay">
                      <option value="AM">AM</option>
                      <option value="PM">PM</option>
                    </select>
                  </div>
                </div>
                <div class="col-md-6 col-sm-6">
                  <span class="font-semi">Out Time</span>
                  <div class="out__time__radio">
                    <select class="time__select" name="outHour" id="outHour"></select>
                    <select class="time__select" name="outMinutes" id="outMinutes"></select>
                    <select class="time__select" name="outMidDay" id="outMidDay">
                      <option value="AM">AM</option>
                      <option value="PM">PM</option>
                    </select>
                  </div>
                </div>
              </div>
              <div class="row no-gutters">
                <div class="col-12 mt-2 mb-1" style="padding-left: 1rem;padding-right: 3rem;">
                  <label for="reason" class="font-semi">What Your Reason</label>
                  <textarea style="width: 100%;" name="reason" id="reason" cols="30" rows="2"></textarea>
                </div>
              </div>
            </li>
            <div class="row mt-3">
              <div class="col d-flex justify-content-end align-items-center">
                <span class="mx-2">
                  <input class="btn btn-secondary" type="submit" data-dismiss="modal" aria-hidden="true" value="Cancel"
                    onclick="CloseButton()">
                </span>
                <span class="mx-2">
                  <input class="btn btn-primary" type="submit" value="Send">
                </span>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
  <!-- End Radio button modal -->
  <!-- Leave modal -->
  <div class="modal fade bs-example-modal-md" id="applyLeaveModal">
    <div class="modal-dialog modal-md modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title" id="myLargeModalLabel2">Apply Leaves</h4>
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true" onclick="CloseButton()">×</button>
        </div>
        <div class="modal-body">
          <form id="leaveForm" action="{% url 'request-approval' %}" class="form-container" method="post"
            enctype="multipart/form-data" onsubmit="openForm()">
            <input type="hidden" name="punch_id_request_approval" id="punch_id">
            {% csrf_token %}
            <div class="row">
              <div class="col-md-12">
                <div class="form-group">
                  <label>Leave Type <span style="color:red">*</span></label>
                  <select class="form-control" name="leave_type" id="leave_type" required>
                    {% for rule in assigned_leave_rules %}
                    {% for applied_rule in rule.rules_applied.all %}
                    <option value="{{ applied_rule.id }}" id="lossOfPayId">
                      {{ applied_rule.leavename }}
                    </option>
                    {% endfor %}
                    {% endfor %}
                  </select>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label>StartDate <span style="color:red">*</span></label>
                  <input type="text" class="form-control form-control-solid date-picker" placeholder="Select Start Date"
                    id="datepicker_1" name="start_date" required readonly>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label>Select First Half <span style="color:red">*</span></label>
                  <select class="form-control" id="browsers" name="first_half" required>
                    <option disabled value="">Select First Half </option>
                    <option selected value="first half">First half</option>
                    <option value="second half">Second half</option>
                  </select>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label>End Date <span style="color:red">*</span></label>
                  <input class="form-control form-control-solid date-picker" placeholder="Select End Date"
                    id="datepicker_2" name="end_date" required readonly>
                  <span id="date-error" style="color: red;font-size: 12px;"></span>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label>Select Second Half <span style="color:red">*</span></label>
                  <select class="form-control" id="browsers" name="second_half" required>
                    <option disabled value="">Select Second Half </option>
                    <option value="first half">First half</option>
                    <option selected value="second half">Second half</option>
                  </select>
                </div>
              </div>
              <div class="col-md-12">
                <div class="form-group">
                  <label>Reason <span style="color:red">*</span></label>
                  <textarea style="height:auto ;" type="text" class="form-control" id="reason" name="reason"
                    required></textarea>
                </div>
              </div>
            </div>
            <!-- punch id -->
            <input type="hidden" name="leave_punch_id" id="leave_punch_id">
            <!-- end punch id -->
            <!-- request approval ID -->
            <input type="hidden" name="requestApproval" id="request_approval">
            <!-- end approval request id -->
            <div class="modal-footer">
              <button type="submit" class="btn btn-primary">Apply</button>
              <button type="button" class="btn btn-secondary" data-dismiss="modal" aria-hidden="true" value="Cancel"
                onclick="CloseButton()">Cancel</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
  <!-- End leave modal -->
  <!-- js -->
  <script src="static/index/vendors/scripts/core.js"></script>
  <script src="static/index/vendors/scripts/script.min.js"></script>
  <script src="static/index/vendors/scripts/process.js"></script>
  <script src="static/index/vendors/scripts/layout-settings.js"></script>
  <script src="static/index/src/plugins/jquery-steps/jquery.steps.js"></script>
  <script src="static/index/vendors/scripts/steps-setting.js"></script>
  <script src="static/index/src/plugins/datatables/js/jquery.dataTables.min.js"></script>
  <script src="static/index/src/plugins/datatables/js/dataTables.bootstrap4.min.js"></script>
  <script src="static/index/src/plugins/datatables/js/dataTables.responsive.min.js"></script>
  <script src="static/index/src/plugins/datatables/js/responsive.bootstrap4.min.js"></script>
  <script src="static/index/vendors/scripts/datatable-setting.js"></script>
  <script src="static/index/src/plugins/datatables/js/dataTables.buttons.min.js"></script>
  <script src="static/index/src/plugins/datatables/js/buttons.bootstrap4.min.js"></script>
  <script src="static/index/src/plugins/datatables/js/buttons.print.min.js"></script>
  <script src="static/index/src/plugins/datatables/js/buttons.html5.min.js"></script>
  <script src="static/index/src/plugins/datatables/js/buttons.flash.min.js"></script>
  <script src="static/index/src/plugins/datatables/js/pdfmake.min.js"></script>
  <script src="static/index/src/plugins/datatables/js/vfs_fonts.js"></script>
  <!-- AG Grid JS -->
  <script src="https://unpkg.com/ag-grid-community@32.1.0/dist/ag-grid-community.min.js"></script>
  <script>
    $(document).ready(function () {
      // Function to get URL parameter value by name
      function getUrlParameter(name) {
        name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
        var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
        var results = regex.exec(location.search);
        return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
      }

      // Initialize a variable to store the selected date
      var urlSelectedDate = getUrlParameter('monthselect');
      var selectedDate = urlSelectedDate || new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' });

      // Initialize datepicker
      $("#monthPicker").datepicker({
        dateFormat: 'MM yyyy',
        defaultDate: urlSelectedDate,
        onSelect: function (date) {
          selectedDate = date;
          $("#search-form").submit();
        }
      });

      // Set the initial value of the input field
      $("#monthPicker").val(selectedDate);

      // AG Grid initialization
      const gridOptions = {
        columnDefs: [
          { headerName: "Date", field: "date", sortable: true, filter: true, valueFormatter: params => {
            if (params.value) {
              const date = new Date(params.value);
              return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
            }
            return '';
          }},
          { headerName: "Status", field: "status", sortable: true, filter: true, cellStyle: params => {
            return params.value === 'AC' || params.value === 'AN' ? { color: 'red' } : {};
          }},
          { headerName: "In Time", field: "in_time", sortable: true, filter: true, valueFormatter: params => {
            return params.value && params.value !== '--' ? params.value : '--';
          }},
          { headerName: "Out Time", field: "out_time", sortable: true, filter: true, valueFormatter: params => {
            return params.value && params.value !== '--' ? params.value : '--';
          }},
          { headerName: "Work Duration", field: "work_duration", sortable: true, filter: true, valueFormatter: params => {
            if (params.value && params.value !== '00:00:00' && params.value !== null) {
              const [hours, minutes] = params.value.split(':');
              return `${hours}: ${minutes}`;
            }
            return '--';
          }},
          { headerName: "Overtime Duration", field: "overtime_duration", sortable: true, filter: true, valueFormatter: params => {
            if (params.value && params.value !== '00:00:00' && params.value !== null) {
              const [hours, minutes] = params.value.split(':');
              return `${hours}:${minutes}`;
            }
            return '--';
          }},
          { headerName: "Break Duration", field: "break_duration", sortable: true, filter: true, valueFormatter: params => {
            if (params.value && params.value !== '00:00:00' && params.value !== null) {
              const [hours, minutes] = params.value.split(':');
              return `<strong>${hours} Hours ${minutes} Mins</strong>`;
            }
            return '--';
          }},
          { headerName: "Breaks", field: "breaks", sortable: true, filter: true },
          {
            headerName: "Action",
            field: "action",
            cellRenderer: params => {
              if (params.data.status === 'AN' || params.data.status === 'A') {
                if (params.data.is_requested && params.data.is_approved) {
                  return '<button class="btn btn-success btn-sm" disabled>Approved</button>';
                } else if (params.data.is_rejected) {
                  return '<button class="btn btn-danger btn-sm">Rejected</button>';
                } else if (params.data.is_requested && !params.data.is_approved && !params.data.is_rejected) {
                  return '<button class="btn btn-warning btn-sm" disabled>Requested</button>';
                } else {
                  return `<button class="btn btn-info btn-sm" id="approval-btn" data-toggle="modal" data-target="#requestModal"
                    onclick="getPunchId('${params.data.id}');get_punch_object('${params.data.in_time}', '${params.data.out_time}', '${params.data.date}')">Get Approval</button>`;
                }
              }
              return '';
            }
          }
        ],
        rowData: [
          {% if punch_in_month %}
          {% for punch in punch_in_month %}
          {
            id: '{{punch.id}}',
            date: '{{punch.date|date:"Y-m-d"}}',
            status: '{{punch.status}}',
            in_time: {% if punch.in_time != '--' %}'{{punch.in_time|time:"h:i A"}}'{% else %}'--'{% endif %},
            out_time: {% if punch.out_time != '--' %}'{{punch.out_time|time:"h:i A"}}'{% else %}'--'{% endif %},
            work_duration: {% if punch.work_duration|time:"H:i:s" != '00:00:00' and punch.work_duration != None %}'{{punch.work_duration|time:"H:i:s"}}'{% else %}null{% endif %},
            overtime_duration: {% if punch.overtime_duration|time:"H:i:s" != '00:00:00' and punch.overtime_duration != None %}'{{punch.overtime_duration|time:"H:i:s"}}'{% else %}null{% endif %},
            break_duration: {% if punch.break_duration|time:"H:i:s" != '00:00:00' and punch.break_duration != None %}'{{punch.break_duration|time:"H:i:s"}}'{% else %}null{% endif %},
            breaks: '{{punch.breaks}}',
            is_requested: {{punch.is_requested|lower}},
            is_approved: {{punch.is_approved|lower}},
            is_rejected: {{punch.is_rejected|lower}}
          },
          {% endfor %}
          {% endif %}
        ],
        pagination: true,
        paginationPageSize: {{ punch_in_month.paginator.per_page }},
        paginationPageSizeSelector: false,
        domLayout: 'normal',
        defaultColDef: {
          flex: 1,
          minWidth: 100,
          resizable: true
        }
      };

      const gridDiv = document.querySelector('#myGrid');
      new agGrid.Grid(gridDiv, gridOptions);
    });
  </script>
  <script>
    function reload() {
      window.location.reload();
    }
  </script>
  <script>
    const Punch_object = {};
    function get_punch_object(in_time, out_time, date) {
      Punch_object.in_time = in_time;
      Punch_object.out_time = out_time;
      Punch_object.date = date;
    }
    document.addEventListener("DOMContentLoaded", function () {
      const inHour = document.getElementById('inHour');
      const outHour = document.getElementById('outHour');
      const inMinutes = document.getElementById('inMinutes');
      const outMinutes = document.getElementById('outMinutes');
      for (let i = 1; i <= 12; i++) {
        var inOption = document.createElement('option');
        inOption.value = i;
        inOption.text = i;
        inHour.appendChild(inOption);
        var outOption = document.createElement('option');
        outOption.value = i;
        outOption.text = i;
        outHour.appendChild(outOption);
      }
      for (let i = 0; i <= 59; i++) {
        var inOption = document.createElement('option');
        inOption.value = i;
        inOption.text = i;
        inMinutes.appendChild(inOption);
        var outOption = document.createElement('option');
        outOption.value = i;
        outOption.text = i;
        outMinutes.appendChild(outOption);
      }
    });

    document.addEventListener("DOMContentLoaded", function () {
      const exactTimeEditGroup = document.getElementsByName('request_approval');
      const exactTimeEditSection = document.getElementById('exactTimeEdit');
      const request_approval = document.getElementById('request_approval');
      const inHours = document.getElementById('inHour');
      const outHours = document.getElementById('outHour');
      const inMinutes = document.getElementById('inMinutes');
      const outMinutes = document.getElementById('outMinutes');
      const inMidDay = document.getElementById('inMidDay');
      const outMidDay = document.getElementById('outMidDay');

      for (let i = 0; i < exactTimeEditGroup.length; i++) {
        exactTimeEditGroup[i].addEventListener('change', function () {
          if (this.value === '2') {
            document.getElementById('requestModal').style.display = 'none';
            $("#applyLeaveModal").modal('show');
            request_approval.value = this.value;
            document.getElementById('leave_punch_id').value = document.getElementById('punch_id').value;
            let datepicker_1 = document.getElementById('datepicker_1');
            let datepicker_2 = document.getElementById('datepicker_2');
            let validDate = getValidDate(Punch_object.date);
            datepicker_1.value = validDate;
            datepicker_2.value = validDate;
          } else if (this.value === '3') {
            exactTimeEditSection.style.display = 'flex';
            exactTimeEditSection.style.flexDirection = 'column';
            const parentInHour = document.getElementById("inHour");
            const parentInMinute = document.getElementById("inMinutes");
            const parentOutHour = document.getElementById("outHour");
            const parentOutMinute = document.getElementById("outMinutes");
            const inMidDay = document.getElementById('inMidDay');
            const outMidDay = document.getElementById('outMidDay');

            if (Punch_object.in_time) {
              const inHour = Punch_object.in_time.split(':')[0];
              const inMinutes = Punch_object.in_time.split(':')[1].split(" ")[0];
              const inAMPM = Punch_object.in_time.split(':')[1].split(" ")[1];
              inMidDay.value = inAMPM;
              for (let i = 1; i <= 12; i++) {
                if (parentInHour.options[i].value == inHour) {
                  parentInHour.options.selectedIndex = i;
                  break;
                }
              }
              for (let i = 0; i <= 59; i++) {
                if (parseInt(parentInMinute.options[i].value, 10) === parseInt(inMinutes, 10)) {
                  parentInMinute.options.selectedIndex = i;
                }
              }
            }
            if (Punch_object.out_time) {
              const outHour = Punch_object.out_time.split(':')[0];
              const outMinutes = Punch_object.out_time.split(':')[1].split(" ")[0];
              const outAMPM = Punch_object.out_time.split(':')[1].split(" ")[1];
              outMidDay.value = outAMPM;
              for (let i = 1; i <= 12; i++) {
                if (parentOutHour.options[i].value == outHour) {
                  parentOutHour.options.selectedIndex = i;
                  break;
                }
              }
              for (let i = 0; i <= 59; i++) {
                if (parseInt(parentOutMinute.options[i].value, 10) === parseInt(outMinutes, 10)) {
                  parentOutMinute.options.selectedIndex = i;
                }
              }
            }
          } else if (this.value === '4') {
            document.getElementById('requestModal').style.display = 'none';
            $("#applyLeaveModal").modal('show');
            request_approval.value = this.value;
            const lossOfPayId = document.getElementById("leave_type").options;
            for (let index = 0; index < lossOfPayId.length; index++) {
              const element = lossOfPayId[index];
              const element_text = element.text;
              if (element_text == "Loss Of Pay") {
                lossOfPayId.selectedIndex = index;
                let datepicker_1 = document.getElementById('datepicker_1');
                let datepicker_2 = document.getElementById('datepicker_2');
                let validDate = getValidDate(Punch_object.date);
                datepicker_1.value = validDate;
                datepicker_2.value = validDate;
              } else {
                element.disabled = true;
              }
            }
            document.getElementById('leave_punch_id').value = document.getElementById('punch_id').value;
          } else {
            exactTimeEditSection.style.display = 'none';
          }
        });
      }
    });

    function getValidDate(inputDateString) {
      var parts = inputDateString.split(", ");
      var monthDayYear = parts[0].split(" ");
      var month = monthDayYear[0];
      var day = parseInt(monthDayYear[1]);
      var year = parseInt(parts[1]);
      var date = new Date(year, getMonthIndex(month), day, 0, 0, 0);
      return day + " " + month + " " + year;
    }

    function getMonthIndex(monthName) {
      var months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
      return months.indexOf(monthName);
    }

    function getPunchId(id) {
      document.getElementById('punch_id').value = id;
    }

    function ReLoad() {
      window.location.reload();
    }

    function CloseButton() {
      document.getElementById('applyLeaveModal').style.display = 'none';
      window.location.reload();
    }
  </script>
</body>
</html>