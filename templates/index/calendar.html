<!DOCTYPE html>
<html>
{% load static %}
<head>
    <!-- Basic Page Info -->
    <meta charset="utf-8">
    <title>HRMS</title>
    <link rel="icon" href="/static/logo/apple-touch-icon.png" type="image/x-icon">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <!-- Site favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="static/index/vendors/images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="static/index/vendors/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="static/index/vendors/images/favicon-16x16.png">

    <!-- Mobile Specific Metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="static/index/vendors/styles/core.css">
    <link rel="stylesheet" type="text/css" href="static/index/vendors/styles/icon-font.min.css">
    <link rel="stylesheet" type="text/css" href="static/index/src/plugins/fullcalendar/fullcalendar.css">
    <link rel="stylesheet" type="text/css" href="static/index/vendors/styles/style.css">

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-119386393-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-119386393-1');
    </script>
    
    {% for user in user_birthday %}
    <style>
        {% with month_day=user.formatted_date|slice:"5:" %}
            .fc-day[data-date*="{{ month_day }}"]::before {
                content: "ðŸŽ‚" ;
                font-family: FontAwesome;
                position: relative;
                top: 85%;
                left: 20%;
                transform: translate(-50%, -40%);
                /* background-color: #020202; */
                color: rgb(0, 0, 0);
                font-size: 20px;
                font-weight: bold;
                z-index: 1;
                width: 20px;
                display: inline-block;
                border-radius: 50%;
                text-align: center;
            } 
        {% endwith %}
    </style>
    {% endfor %} 

    {% for user in user_workann %}
    <style>
        {% with month_day=user.ann_date|slice:"5:" %}
            .fc-day[data-date*="{{ month_day }}"]::before {
                content: "ðŸŽŠ" ;
                font-family: FontAwesome;
                position: relative;
                top: 85%;
                left: 10%;
                transform: translate(-50%, -40%);
                /* background-color: #020202; */
                color: rgb(0, 0, 0);
                font-size: 20px;
                font-weight: bold;
                z-index: 1;
                width: 20px;
                display: inline-block;
                border-radius: 50%;
                text-align: center;
            } 
        {% endwith %}
    </style>
    {% endfor %} 

    {% for date, count in leave_counts.items %}
    <style>
        .fc-day[data-date="{{ date }}"]::after{
            content: "{{ count }}";
            position: relative;
            top: 85%;
            left: 80%;
            transform: translate(-50%, -50%);
            background-color: #f75757;
            color: #FFFFFF;
            font-size: 12px;
            font-weight: bold;
            z-index: 1;
            width: 18px;
            display: inline-block;
            border-radius: 50%;
            text-align: center;
        }
    </style>
    {% endfor %}

    <style>

        {% for i in holiday_list %}

            .fc-day[data-date="{{ i.Holiday_List.get_formatted_date }}"] {
                {% if i.HolidayToggleBtn_ON == 'on' %}
                background-color: #1498f7;
                {% elif i.HolidayToggleBtn_ON == 'off' %}
                    background-color: #04bc63;
                {% endif %}
                }
        {% endfor %}

        .holiday-box {
            width: 20px;
            height: 20px;
            display: inline-block;
            margin-right: 10px;
        }
    
        .optional-holiday {
            background-color: #1498f7;
        }
    
        .mandatory-holiday {
            background-color: #04bc63;
        }
        .leave-day{
            background-color: #f75757;
        }
        .holiday_legend{
            display: flex;
            padding: 10px;
        }

        .holiday_legend .legend-item {
            width: 175px;
            display: flex;
            align-items: center;
            margin-right: 10px;
        }
    
        .main{
            max-height: 104px;
            overflow: auto;
        }
        .main .employeeList {
            padding: 3px;
            margin: 3px;
        }
        .main .employeeList li {
            padding: 5px 15px;
            border-bottom: 1px solid #C7D7E6;
        }
        .ed .ei img {
            height: 50px;
            width: 50px;
            border-radius: 50%;
        }
        .ed div {
            display: inline-block;
            vertical-align: middle;
        }
        .ed .ec {
            padding-left: 25px;
        }
        .ed .ecen {
            font-weight: 600;
            font-size: 14px;
        }

        .ed p {
            margin: 0px;
            padding: 0px;
        }
        .ed .ecede {
            color: #4A4A4A;
            font-size: 14px;
            opacity: 0.6;
        }
    </style>
    
</head>
<body>

    <div class="mainSideBarFlex">
        <div class="left-side-bar">
        <div class="headBlockMain">
            <div  class="bgSecMainall">
    <div class="profileIconDiv">
        <div  class="profileImgWrapper">
            <img src="/media/school-logo.png" alt="" >
        
        </div>
        <div  class="profiletxt">
            <span  class="head-name">Edship Technologies</span>
            <p  class="sub-head">Transport Dashboard</p>
        </div></div><div  class="school-info">
            <div  class="flex-container">
                <div class="schoolInfoImgWrapper">
                    <img  src="/media/school-image.png" alt="School Logo" class="logo">
                </div><div  class="schooolInfoDetails">
                    <h2>Public School</h2>
                    <div  class="location">
                        <i  class="bi bi-geo-alt"></i>
                        <span >Kaloor, Kochi</span></div></div></div></div></div>
        </div>

      
       <div class="menu-block customscroll">
            <div class="sidebar-menu">
               <ul id="accordion-menu">
					
			
			
					<li>
						<a  href="{% url 'personalinfonav' %}" class="dropdown-toggle no-arrow active">
                          
                                	<span class="micon dw dw-user1"></span>
                                    <span class="mtext">My Profile</span>
                    
						
						</a>
					</li>
					<li>
						<a href="{% url 'leave' %}" class="dropdown-toggle no-arrow">
							<span class="micon dw dw-calendar-1"></span>
                            <span class="mtext">Leave</span>
						</a>
					</li>
					<li>
						<a href="{% url 'directory' %}" class="dropdown-toggle no-arrow">
							<span class="micon dw dw-list"></span>
                            <span class="mtext">Directory</span>
						</a>
					</li>
					<li>
						<a href="{% url 'dailylog' %}" class="dropdown-toggle no-arrow">
							<span class="micon bi bi-check2-square"></span>
                            <span class="mtext">Attendance</span>
						</a>
					</li>
					<li>
						<a href="{% url 'calender' %}" class="dropdown-toggle no-arrow">
							<span class="micon dw dw-calendar"></span>
                            <span class="mtext">Holiday Calendar</span>
						</a>
					</li>
					<li>
						<a href="{% url 'runpayroll_overview' %}" class="dropdown-toggle no-arrow">
							<span class="micon dw dw-money-2"></span>
                            <span class="mtext">Payroll</span>
						</a>
					</li>


				</ul>
            </div>
        </div>
    </div>
    <div class="main-container">
            <div class="header">
        <div class="header-left">
            <div class="menu-icon dw dw-menu"></div>
            <div class="holiday_legend" style="padding-left: 1.25rem;">
                <div class="legend-item">
                    <div class="holiday-box optional-holiday"></div>
                    <span>Optional Holiday</span>
                </div>
                <div class="legend-item">
                    <div class="holiday-box mandatory-holiday"></div>
                    <span>Mandatory Holiday</span>
                </div>
                <div class="legend-item">
                    <div class="holiday-box leave-day"></div>
                    <span>Leave</span>
                </div>
            </div>
        </div>
        <div class="header-right">
            <div class="dashboard-setting user-notification">
                <div class="dropdown">
                    <a class="dropdown-toggle no-arrow" href="javascript:;" data-toggle="right-sidebar">
                        
                    </a>
                </div>
            </div>
            <!-- <div class="user-notification">
                <div class="dropdown">
                    <a class="dropdown-toggle no-arrow" href="#" role="button" data-toggle="dropdown">
                        <i class="icon-copy dw dw-notification"></i>
                        <span class="badge notification-active"></span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-right">
                        <div class="notification-list mx-h-350 customscroll">
                            <ul>
                                <li>
                               
                              
                                       <a href="#">
                                        <img src="static/index/vendors/images/img.jpg" alt="">
                                        <h3>John Doe</h3>
                                        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed...</p>
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <img src="static/index/vendors/images/photo1.jpg" alt="">
                                        <h3>Lea R. Frith</h3>
                                        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed...</p>
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <img src="static/index/vendors/images/photo2.jpg" alt="">
                                        <h3>Erik L. Richards</h3>
                                        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed...</p>
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <img src="static/index/vendors/images/photo3.jpg" alt="">
                                        <h3>John Doe</h3>
                                        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed...</p>
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <img src="static/index/vendors/images/photo4.jpg" alt="">
                                        <h3>Renee I. Hansen</h3>
                                        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed...</p>
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <img src="static/index/vendors/images/img.jpg" alt="">
                                        <h3>Vicki M. Coleman</h3>
                                        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed...</p>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div> -->
            <div class="user-info-dropdown">
                <div class="dropdown">
                    <a class="dropdown-toggle" href="#" role="button" data-toggle="dropdown">
                        <span class="user-icon">
                            {% if k.image %}
                            <img src="{{ k.image.url }}" alt="" >
                        {% else %}
                         <img src="/static/logo/userlogo.png" id="photo">
                        {% endif %}                         </span>
                            <span class="user-name">{{request.user.username}}</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right dropdown-menu-icon-list">
                            <a class="dropdown-item" href="{% url 'createpersonalinfo' %}"><i class="dw dw-user1"></i> Profile</a>
                            <a class="dropdown-item" href="{% url 'department' %}" data-toggle="right-sidebar"><i class="dw dw-settings2"></i> Settings</a>
                            <a class="dropdown-item" href="{% url 'help_page' %}"><i class="dw dw-help"></i> Help</a>
                            <a class="dropdown-item" href="{% url 'logout' %}"><i class="dw dw-logout"></i> Logout</a>
                        </div>
                    </div>
               </div>
            
            
            </div>
        </div>
         <!--class="pd-ltr-20 xs-pd-20-10"-->
            <!-- <div class="min-height-200px"> -->
                <div class="card-box height-100-p overflow-hidden">
                    <!-- <div class="profile-tab height-100-p"> -->
                        <!-- <div class="tab height-100-p"> -->
                            <!-- <br><h4 class="text-blue h4" style="padding-left:1%">COMPANY PROFILE</h4> -->
                    <ul class="nav nav-tabs customtab" role="tablist" >
                        <li class="nav-item">
                            <a class="nav-link active" href="{% url 'calender' %}">Calendar</a>
                        </li>
                         <li class="nav-item">
                            <a class="nav-link" href="{% url 'Holidayview' %}">Holiday List</a>
                        </li>
                    </ul>
     
            <div class="min-height-200px">
                
                <div class="pd-20 card-box">
                    
                    <div class="calendar-wrap">
                        <div id='calendar'></div>
                    </div>

                    <!-- <div class="holiday_legend">
                        <div class="legend-item">
                            <div class="holiday-box optional-holiday"></div>
                            <span>Optional Holiday</span>
                        </div>
                        <div class="legend-item">
                            <div class="holiday-box mandatory-holiday"></div>
                            <span>Mandatory Holiday</span>
                        </div>
                        
                    </div> -->

                    <div id="modal-view-event-add" class="modal modal-top fade calendar-modal">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h4 class="modal-title" >Details</h4>
                                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                                </div>
                                <form id="add-event">
                                    <div class="modal-body">
                                        
                                        <div class="row">
                                            <div class="col-md-12" id="display_date">
                                                <div class="form-group">
                                                </div>
                                            </div>

                                        </div>
                                    
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
    </div>
    </div>
    </div>


    <!-- <div class="right-sidebar">
        <div class="sidebar-title">
            <h3 class="weight-600 font-16 text-blue">
                Settings -->
                <!--<span class="btn-block font-weight-400 font-12">User Interface Settings</span>-->
            <!-- </h3>
            <div class="close-sidebar" data-toggle="right-sidebar-close">
                <i class="icon-copy ion-close-round"></i>
            </div>
        </div>

        <div class="right-sidebar-body customscroll">
            <div class="right-sidebar-body-content">
                <h4 class="weight-600 font-18 pb-10" ><a href="{% url 'department' %}">Department</a> </h4>
                <h4 class="weight-600 font-18 pb-10" ><a href="{% url 'subdepartment' %}">Sub Department</a> </h4>
                <h4 class="weight-600 font-18 pb-10"><a href="{% url 'designation' %}">Designation</a></h4>
                <h4 class="weight-600 font-18 pb-10"><a href="{% url 'job' %}">Job Title</a></h4>
                <h4 class="weight-600 font-18 pb-10"><a href="{% url 'wrk' %}">Work location</a></h4>
            </div>
        </div>  
    </div> -->

    



    <!-- js -->
    <script src="static/index/vendors/scripts/core.js"></script>
    <script src="static/index/vendors/scripts/script.min.js"></script>
    <script src="static/index/vendors/scripts/process.js"></script>
    <script src="static/index/vendors/scripts/layout-settings.js"></script>
    <script src="static/index/src/plugins/fullcalendar/fullcalendar.min.js"></script>
    <script src="static/index/vendors/scripts/calendar-setting.js"></script>
    
<script>
    $(document).ready(function () {
    var holidayData = {{ holiday_data | safe }};
    var leaveData = {{ leave_data | safe }};
    var userBirthData = {{ user_birthday | safe }}; 
    var userWorkannData = {{ user_workann | safe }}; 

    $('#calendar').on('click', '.fc-day, .fc-day-top', function () {
        var selectedDate = $(this).data('date');
        //console.log("selectedDate:", selectedDate);
        var formattedDate = formatDate(selectedDate);

        var datestr = new Date(selectedDate);
        //console.log("selecteddate 2:", datestr);
        var selectedDay = String(datestr.getDate()).padStart(2, '0');
        var selectedMonth = String(datestr.getMonth() + 1).padStart(2, '0'); 
        // console.log("selectedMonth:", selectedDay, selectedMonth);
        // console.log("Holiday Data: ", holidayData);
        var holidayEntry = holidayData.find(entry => entry.date === selectedDate);

        var leaveEntries = leaveData.filter(entry => entry.date === selectedDate || (entry.date <= selectedDate && entry.enddate >= selectedDate));
        
        var usersBirthday = userBirthData.filter(entry => entry.day === selectedDay && entry.month === selectedMonth);

        var usersAnniversary = userWorkannData.filter(entry => entry.ann_day === selectedDay && entry.ann_month === selectedMonth);

        var displayContent = '<p>Details for ' + formattedDate + '</p>';

        if (holidayEntry) {
            if (holidayEntry.toggle_btn === 'on') {
                displayContent += '<p>Optional Holiday : ' + holidayEntry.holiday_name + '</p>';
            } else if (holidayEntry.toggle_btn === 'off') {
                displayContent += '<p>Mandatory Holiday : ' + holidayEntry.holiday_name + '</p>';
            }
        }

        if (usersBirthday.length > 0) {
            displayContent += '<b>Employee Birthday</b>';
        usersBirthday.forEach(function (userEntry) {
            displayContent += '<div class="main">' +
            '<ul class="employeeList appLeaves">' +
                '<li>' +
                '<div class="ed">' +
                '<div class="ei">' +
                '<img src="' + userEntry.image + '">' +
                '</div>' +
                '<div class="ec">' +
                '<p class="ecen">' + userEntry.username + '</p>' +
                '<p class="ecede">' + userEntry.designation + '</p>' +
                '</div>' +
                '</div>' +
                '</li>' +
                '</ul>' +
                '</div>'; 
        });
        }
        if (usersAnniversary.length > 0 && usersAnniversary.some(entry => entry.ann_date)) {
        displayContent += '<b>Employee Work Anniversary</b>';
        usersAnniversary.forEach(function (userEntry) {
            if (userEntry.ann_date) {
                displayContent += '<div class="main">' +
                    '<ul class="employeeList appLeaves">' +
                    '<li>' +
                    '<div class="ed">' +
                    '<div class="ei">' +
                    '<img src="' + userEntry.user_image + '">' +
                    '</div>' +
                    '<div class="ec">' +
                    '<p class="ecen">' + userEntry.username + '</p>' +
                    '<p class="ecede">' + userEntry.designation + '</p>' +
                    '</div>' +
                    '</div>' +
                    '</li>' +
                    '</ul>' +
                    '</div>';
            }
        });
    }

        if (leaveEntries.length > 0) {
            displayContent += '<b>Employee Leave</b>';
        leaveEntries.forEach(function (leaveEntry) {
            displayContent += '<div class="main">' +
                '<ul class="employeeList appLeaves">' +
                '<li>' +
                '<div class="ed">' +
                '<div class="ei">' +
                '<img src="' + leaveEntry.image + '">' +
                '</div>' +
                '<div class="ec">' +
                '<p class="ecen">' + leaveEntry.applicant_name + '</p>' +
                '<p class="ecede">' + leaveEntry.designation + '</p>' +
                '</div>' +
                '</div>' +
                '</li>' +
                '</ul>' +
                '</div>';
        });
        }
        
        $('#display_date').html(displayContent);

        $('#modal-view-event-add').modal('show');
    });

    function formatDate(dateString) {
        var dateObj = new Date(dateString);

        if (isNaN(dateObj.getTime())) {
            return 'Invalid Date';
        }

        var options = { day: 'numeric', month: 'long', year: 'numeric' };
        return dateObj.toLocaleDateString('en-GB', options);
    }
});

</script>

</body>
</html>

