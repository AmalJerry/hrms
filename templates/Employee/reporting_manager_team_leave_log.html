<!DOCTYPE html>
<html>
{% load static %}

<head>
    <!-- Basic Page Info -->
    <meta charset="utf-8">
    <title>HRMS</title>

    <link rel="icon" href="/static/logo/apple-touch-icon.png" type="image/x-icon">

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <!-- Site favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="static/index/vendors/images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="static/index/vendors/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="static/index/vendors/images/favicon-16x16.png">

    <!-- Mobile Specific Metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="/static/index/vendors/styles/core.css">
    <link rel="stylesheet" type="text/css" href="/static/index/vendors/styles/icon-font.min.css">
    <link rel="stylesheet" type="text/css"
        href="/static/index/src/plugins/datatables/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" type="text/css"
        href="/static/index/src/plugins/datatables/css/responsive.bootstrap4.min.css">
    <link rel="stylesheet" type="text/css" href="/static/index/vendors/styles/style.css">

    <!-- Jquery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
        integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- Data table css -->
    <link rel="stylesheet" href="https://cdn.datatables.net/2.0.7/css/dataTables.dataTables.css" />
    <script src="https://cdn.datatables.net/2.0.7/js/dataTables.js"></script>


    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-119386393-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'UA-119386393-1');
    </script>
    <style>
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            top: 10px;
            right: 10px;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        span.close {
            padding-left: 428px;
            position: absolute;
            top: 10px;
            right: 50%;
            transform: translateX(50%);
        }

        @media (max-width: 1300px) {}

        .user-info-dropdown.approve {
            margin-top: 9%;
            margin-left: -57%;
        }

        th {
            top: -2px;
            background-color: #fff;
            white-space: nowrap;
            text-align: left !important;
            z-index: 10;
        }

        td {
            border: 1px solid #e0e0e0;
            background-color: #fff;
        }

        th:nth-child(1),
        td:nth-child(1) {
            position: sticky;
            left: -1px;
            width: 0;
            background-color: #fff;
            z-index: 30;
        }

        th:nth-child(2),
        td:nth-child(2) {
            position: sticky;
            left: 67.5px;
            width: 5%;
            background-color: #fff;
            z-index: 25;

        }

        tr:nth-child(even) td {
            background: #fff;
        }

        tr:nth-child(odd) td {
            background: #eaeef2;
        }

        tbody td:nth-child(n+2):nth-child(-n+14):hover {
            cursor: pointer;
        }

        div.dt-container {
            width: 100%;
            margin: 0 auto;
        }

        #dt-length-0 {
            margin-right: 0.5rem !important;
        }
    </style>



</head>

<body>

    <div class="header">
        <div class="header-left">
            <div class="menu-icon dw dw-menu"></div>
            <!-- <div class="search-toggle-icon dw dw-search2" data-toggle="header_search"></div> -->


        </div>
        <div class="header-right">
            <div class="dashboard-setting user-notification">
                <div class="dropdown">
                    <a class="dropdown-toggle no-arrow" href="javascript:;" data-toggle="right-sidebar">

                    </a>
                </div>
            </div>

            <div class="user-info-dropdown" style="margin-top: 2%;margin-right: 15%;">
                <div class="dropdown">
                    <button class="btn btn-primary" data-toggle="modal" href="#export_Modal"
                        style="border-color: white;">Export</button>
                </div>
            </div>

            <form method="post" action="{% url 'bulk_approve_leave' %}">
                {% csrf_token %}
                <div class="user-info-dropdown approve">
                    <div class="dropdown">
                        <button class="btn btn-primary" data-toggle="modal" href="" style="border-color: white;">Bulk
                            Approve</button>
                    </div>
                </div>
            </form>

            <!-- <div class="user-notification">
                <div class="dropdown">
                    <a class="dropdown-toggle no-arrow" href="#" role="button" data-toggle="dropdown">
                        <i class="icon-copy dw dw-notification"></i>
                        <span class="badge notification-active"></span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-right">
                        <div class="notification-list mx-h-350 customscroll">
                            <ul>
                                <li>
                                    <a href="#">
                                        <img src="static/index/vendors/images/img.jpg" alt="">
                                        <h3>John Doe</h3>
                                        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed...</p>
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <img src="static/index/vendors/images/photo1.jpg" alt="">
                                        <h3>Lea R. Frith</h3>
                                        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed...</p>
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <img src="static/index/vendors/images/photo2.jpg" alt="">
                                        <h3>Erik L. Richards</h3>
                                        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed...</p>
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <img src="static/index/vendors/images/photo3.jpg" alt="">
                                        <h3>John Doe</h3>
                                        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed...</p>
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <img src="static/index/vendors/images/photo4.jpg" alt="">
                                        <h3>Renee I. Hansen</h3>
                                        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed...</p>
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <img src="static/index/vendors/images/img.jpg" alt="">
                                        <h3>Vicki M. Coleman</h3>
                                        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed...</p>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div> -->
            <div class="user-info-dropdown">
                <div class="dropdown">
                    <a class="dropdown-toggle" href="#" role="button" data-toggle="dropdown">
                        <span class="user-icon">
                            {% if k.image %}
                            <img src="{{ k.image.url }}" alt="" style="width: 100%; height:100% ">
                            {% else %}
                            <img src="/static/logo/userlogo.png" id="photo" style="width: 100%; height:100% ">
                            {% endif %}
                        </span>
                        <span class="user-name">{{request.user.username}}</span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-right dropdown-menu-icon-list">
                        <a class="dropdown-item" href="{% url 'createpersonalinfo' %}"><i class="dw dw-user1"></i>
                            Profile</a>
                        <a class="dropdown-item" href="{% url 'department' %}" data-toggle="right-sidebar"><i
                                class="dw dw-settings2"></i> Settings</a>
                        <a class="dropdown-item" href="{% url 'help_page' %}"><i class="dw dw-help"></i> Help</a>
                        <a class="dropdown-item" href="{% url 'logout' %}"><i class="dw dw-logout"></i> Logout</a>
                    </div>
                </div>
            </div>

        </div>
    </div>
    <div class="left-side-bar">
        <div class="brand-logo mt-3">
            <a href="{% url 'empdash' %}">
                {% if request.user.company_type %}
                {% if request.user.company_type.inverse_logo %}
                <img src="{{ request.user.company_type.inverse_logo.url }}" alt="company logo" style="width: 100%; height: 100%;">
                {% else %}
                <img src="/static/logo/deskapp-logo-white.svg" alt="deskapp logo" class="light-logo">
                {% endif %}
                {% else %}
                <img src="/static/logo/deskapp-logo-white.svg" alt="deskapp logo 2" class="light-logo">
                {% endif %}
            </a>
            <div class="close-sidebar" data-toggle="left-sidebar-close">
                <i class="ion-close-round"></i>
            </div>
        </div> <br>

        <div class="menu-block customscroll">

            <div class="sidebar-menu">
                <ul id="accordion-menu">
                    <li class="dropdown">
                    </li>
                    <li class="btn-primary active" style="background-color: black">
                        <a href="{% url 'empdash' %}" class="dropdown-toggle no-arrow">
                        <span class="micon dw dw-house-1"></span><span class="mtext"><b>Dashboard</b></span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'empoverview' %}" class="dropdown-toggle no-arrow">
                        <span class="micon dw dw-building"></span><span class="mtext"><b>Company Profile</b></span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'emppersonalinfonav' %}" class="dropdown-toggle no-arrow">
                        <span class="micon dw dw-user1"></span><span class="mtext"><b>My Profile</b></span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'empleave' %}" class="dropdown-toggle no-arrow">
                        <span class="micon dw dw-calendar-1"></span><span class="mtext"><b>Leave</b></span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'empdirectory' %}" class="dropdown-toggle no-arrow">
                        <span class="micon dw dw-list"></span><span class="mtext"><b>Directory</b></span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'empdailylog' %}" class="dropdown-toggle no-arrow">
                        <span class="micon bi bi-check2-square"></span><span class="mtext"><b>Attendance</b></span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'emp_calender' %}" class="dropdown-toggle no-arrow">
                        <span class="micon dw dw-calendar"></span><span class="mtext"><b>Holiday Calendar</b></span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>



    <form action="{% url 'export_leave_data' %}" method="post" onsubmit="return validateForm()">
        {% csrf_token %}
        <div class="modal fade bs-example-modal-sm" id="export_Modal" tabindex="-1" role="dialog"
            aria-labelledby="myLargeModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-sm">

                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Export</h4>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>

                    </div>
                    <div class="modal-body">
                        <div class="row">

                            <div class="col-md-12">
                                <label>Select Month and Year</label>
                            </div>

                            <div class="col-md-12">
                                <!-- <label>From <span style="color:red"> &#42</span></label> -->
                                <div class="form-group">
                                    <input class="form-control month-picker" type="text" id="monthPicker"
                                        name="monthselect" placeholder="Month , Year" readonly />
                                </div>
                            </div>

                            <!-- <div class="col-md-12">
                                    <label>To <span style="color:red"> &#42</span></label>
                                    <div class="form-group">
                                        <input class="form-control date-picker" type="text" name="enddate" id="enddate" placeholder="dd-mm-yyy" style="background-color: white;" readonly>
                                    </div>
                                </div> -->
                        </div>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="submit" id="exportButton" class="btn btn-primary" data-toggle="modal"
                            href="">Export</button>
                    </div>

                </div>
            </div>
        </div>
    </form>


    <div class="mobile-menu-overlay"></div>

    <div class="main-container">
        <div class="card-box height-100-p overflow-hidden">
            <ul class="nav nav-tabs customtab" role="tablist">
                <li class="nav-item">
                    <a class="nav-link " href="{% url 'empleave' %}" role="tab">Apply Leave</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'emplog' %}" role="tab">Logs</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'empRules' %}" role="tab">Rules</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" href="{% url 'reporting_manager_team_log' %}" role="tab">Team Log</a>
                </li>
            
            </ul>

            <!-- <div class="min-height-100px">
                <ul class="nav nav-tabs customtab" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link"  href="{% url 'admin_log' %}" role="tab">Logs</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active"  href="{% url 'log' %}" role="tab">All Logs</a>
                        </li>
                    </ul>
                    
            </div>  -->

            <div class="pd-20 card-box">
                <!-- <div id="DataTables_Table_3_wrapper" class="dataTables_wrapper dt-bootstrap4 no-footer"> -->

                <!-- <div class="table-bordered" style="height: 380px; overflow-x: auto; overflow-y: auto;"> -->

                <table id="data_Table" class=" table table-striped" style="width:100%">
                    <thead>
                        <tr>
                            <th scope="col" style="background-color: #fff;">Employee Name</th>
                            <th scope="col" style="background-color: #fff;">Leave Type</th>
                            <th scope="col" style="background-color: #fff;">Start Date</th>
                            <th scope="col" style="background-color: #fff;">End Date</th>
                            <th scope="col" style="background-color: #fff;">Days</th>
                            <th scope="col" style="background-color: #fff;">Reason</th>
                            <th scope="col" style="background-color: #fff;">Applied on</th>
                            <th scope="col" style="background-color: #fff;">Status</th>
                            <th scope="col" style="background-color: #fff;">Actions</th>

                        </tr>
                    </thead>
                    <tbody>

                        {% for i in data %}

                        <tr>
                            <td> {{i.applicant_email.username }}</td>
                            <td> {{i.leavetyp}}</td>
                            <td>{{i.strtDate}} </td>
                            <td>{{i.endDate}} </td>
                            <td>{{ i.Days }}</td>
                            <td style="width: 20%;">{{i.Reason}}</td>
                            <td> {{i.Appliedon}}</td>
                            <td>
                                {% if i.status == 'Approved' %}
                                Approved
                                {% elif i.status == 'Rejected' %}
                                Rejected
                                {% else %}
                                Pending
                                {% endif %}
                            </td>

                            <td>
                                {% if i.status == 'Rejected' %}
                                <form action="{% url 'cancel_leave' %}" method="post" style="display: inline;">
                                    {% csrf_token %}
                                    <input type="hidden" name="leave_id" value="{{ i.id }}">
                                    <button type="submit" class="btn" data-bgcolor="#666666" data-color="#ffffff">
                                        Cancel
                                    </button>
                                </form>
                                {% elif i.status == 'Approved' %}
                                <form action="{% url 'cancel_leave' %}" method="post" style="display: inline;">
                                    {% csrf_token %}
                                    <input type="hidden" name="leave_id" value="{{ i.id }}">
                                    <button type="submit" class="btn" data-bgcolor="#666666" data-color="#ffffff">
                                        Cancel
                                    </button>
                                </form>
                                {% else %}
                                <form action="{% url 'approve_leave' %}" method="post" style="display: inline;">
                                    {% csrf_token %}
                                    <input type="hidden" name="leave_id" value="{{ i.id }}">
                                    <button type="submit" class="btn btn-sm btn-success">
                                        <i class="icon-copy ion-checkmark-round"></i>
                                    </button>
                                </form>
                                <!-- Add a link or button to trigger the rejection popup -->
                                <a href="#" class="reject-link" data-leave-id="{{ i.id }}">
                                    <button class="btn btn-sm btn-danger">
                                        <i class="icon-copy ion-close-round"></i>
                                    </button>
                                </a>
                                {% endif %}
                            </td>
                        </tr>

                        {% endfor %}

                    </tbody>
                </table>
            </div>
            {% if not data %}
            <p style="text-align: center; ">No Data Found</p>
            {% endif %}

            <!-- <div class="clearfix">
                    <div class="pull-left">
                        <div class="dataTables_info" id="DataTables_Table_3_info" role="status" aria-live="polite">{{ data.start_index }} - {{ data.end_index }} of {{ data.paginator.count }} entries</div>
                    </div>
                    <div class="pull-right">
                        <div class="dataTables_paginate paging_simple_numbers" id="DataTables_Table_0_paginate">
                            <ul class="pagination">
                                {% if data.has_previous %}
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ data.previous_page_number }}">< Previous</a>
                                </li>
                                {% else %}
                                <li class="page-item disabled">
                                    <a class="page-link"><</a>
                                </li>
                                {% endif %}
                                {% for i in data.paginator.page_range %} 
                                
                                {% if i <= data.number|add:5 and i >= data.number|add:-5 %}
                    
                                {% if data.number == i %}
                                <li class="page-item active">
                                    <a class="page-link" href="?page={{forloop.counter}}">{{forloop.counter}}</a>
                                </li>
                                {% else %}
                                <li class="page-item">
                                    <a class="page-link" href="?page={{forloop.counter}}">{{forloop.counter}}</a>
                                </li>
                                {% endif %}
                    
                                {% endif %}
                                {% endfor %} 
                    
                                {% if data.has_next %}
                    
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ data.next_page_number }}">&raquo; ></a>
                                </li>
                                {% else %}
                                <li class="page-item disabled">
                                    <a class="page-link">></a>
                                </li>
                                {% endif %}
                                </ul>
                        </div>
                    </div>
                </div> -->

            <!-- </div> -->
            <!-- </div> -->
            <!-- Checkbox select Datatable End -->
            <!-- </div> -->

        </div>

        <div id="rejection-modal" class="modal bs-example-modal-md rejection-modal">
            <div class="modal-dialog modal-md modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Rejection Leave</h4>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>

                    <div class="modal-body">
                        <form id="rejection-form" method="POST" action="{% url 'reject_leave' %}">
                            {% csrf_token %}
                            <div class="row">
                                <div class="col-md">
                                    <div class="form-group">
                                        <label>Rejection Reason<span style="color:red">&#42</span></label>
                                        <textarea rows="4" cols="50" type="text" class="form-control"
                                            id="rejection-reason" name="rejection_reason" required></textarea>
                                    </div>
                                </div>
                            </div>
                            <input type="hidden" id="leave-id" name="leave_id" value="">
                            <div class="modal-footer">
                                <button type="submit" class="btn btn-secondary">Submit</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <!-- Checkbox select Datatable start -->

        <!-- Export Datatable End -->
    </div>

    </div>
    </div>
    <!-- js -->
    <script src="static/index/vendors/scripts/core.js"></script>
    <script src="static/index/vendors/scripts/script.min.js"></script>
    <script src="static/index/vendors/scripts/process.js"></script>
    <script src="static/index/vendors/scripts/layout-settings.js"></script>
    <script src="static/index/src/plugins/datatables/js/jquery.dataTables.min.js"></script>
    <script src="static/index/src/plugins/datatables/js/dataTables.bootstrap4.min.js"></script>
    <script src="static/index/src/plugins/datatables/js/dataTables.responsive.min.js"></script>
    <script src="static/index/src/plugins/datatables/js/responsive.bootstrap4.min.js"></script>
    <!-- buttons for Export datatable -->
    <script src="static/index/src/plugins/datatables/js/dataTables.buttons.min.js"></script>
    <script src="static/index/src/plugins/datatables/js/buttons.bootstrap4.min.js"></script>
    <script src="static/index/src/plugins/datatables/js/buttons.print.min.js"></script>
    <script src="static/index/src/plugins/datatables/js/buttons.html5.min.js"></script>
    <script src="static/index/src/plugins/datatables/js/buttons.flash.min.js"></script>
    <script src="static/index/src/plugins/datatables/js/pdfmake.min.js"></script>
    <script src="static/index/src/plugins/datatables/js/vfs_fonts.js"></script>
    <!-- Datatable Setting js -->
    <script src="static/index/vendors/scripts/datatable-setting.js"></script>
    <script src="static/index/src/plugins/jquery-steps/jquery.steps.js"></script>
    <script src="static/index/vendors/scripts/steps-setting.js"></script>
    <script src="static/utility.js"> </script>

    <script>
        $(document).ready(function () {
            $('#exportButton').on('click', function () {
                var startDate = $('#startdate').val();
                var endDate = $('#enddate').val();

                if (startDate !== '' && endDate !== '') {
                    $('#downloadexcel').modal('show');
                } else {
                    alert('Please select both start and end dates.');
                }
            });
        });
    </script>

    <script>

        document.addEventListener('DOMContentLoaded', function () {
            var rejectLinks = document.getElementsByClassName('reject-link');
            var modal = document.getElementById('rejection-modal');
            var leaveIdField = document.getElementById('leave-id');
            var closeButton = document.getElementsByClassName('close')[1];

            for (var i = 0; i < rejectLinks.length; i++) {
                rejectLinks[i].addEventListener('click', function (event) {
                    event.preventDefault();
                    var leaveId = this.getAttribute('data-leave-id');
                    leaveIdField.value = leaveId;
                    modal.style.display = 'block';
                });
            }

            closeButton.addEventListener('click', function () {
                modal.style.display = 'none';
            });

            // Add an event listener to the rejection form submit button
            var rejectionForm = document.getElementById('rejection-form');
            var rejectionSubmitButton = rejectionForm.querySelector('button[type="submit"]');
            rejectionSubmitButton.addEventListener('click', function () {

            });
        });



    </script>
    <script>
        new DataTable("#data_Table", {
            paging: true,
            scrollX: false,
            scrollY: 350,
            ordering: false,
            searching: true,
            pageLength: 50
        })
    </script>
</body>

</html>